<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.1.0.695
-->

# Playbook - Threat Analysis with Uptycs Alerts (PB)

### API Name
`threat_analysis_with_uptycs_alerts_pb`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Object Type
`incident`

### Description
sample playbook for collecting alert data from Uptycs into the IBM QRADAR SOAR


---
## Function - uptycs api

### API Name
`uptycs_api`

### Output Name
`alertdata`

### Message Destination
`fn_uptycs_api`

### Function-Input Script
```python
""" Sample Function to pull alert information via Uptycs API"""

import json



# alert id used to pull the data of alert that triggered this incident
alertID = incident.properties.uptycs_alert_id


# Uptycs Alert Endpoint
endpoint = f'/alertsReporting/{alertID}'




# Inputs for function
inputs.uptycs_api_method = 'GET'
inputs.uptycs_api_endpoint = endpoint
inputs.uptycs_api_payload = json.dumps({})





```

---

## Local script - Set Incident Parameters(Alert)

### Description
sets incident severity and discovered date based on the Uptycs alert severity and alertTime

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
# Set Incident Severity
severity = incident.properties.uptycs_alert_severity


incident.severity_code = severity[0].upper() + severity[1:]




```

---
## Local script - Set JSON Data (To get the corresponding rich text)

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
"""
Set alert data to playbook property named "json_data" to get the corresponding Rich Text HTML Code
"""

jsonData = {
   "heading": "Uptycs Alert Data",
   "content": playbook.functions.results.alertdata.content
}


playbook.addProperty('json_data', jsonData)


```

---
## Global script - JSON TO HTML (RICH TEXT)

### Description
Converts provided JSON Data to Rich Text and adds it as a note to the corresponding Incident

### Script Type
`Global script`

### Object Type
`incident`

### Script Content
```python
"""
Set the Json Data that you would like to convert to rich text in a playbook property called "json_data" using playbook.addProperty('json_data', JSON_DATA)

JSON_DATA should have two keys, heading and content.

ex: JSON_DATA = {
   "heading" : "Uptycs Alert Data",
   "content" : {},   =======> json object
}

It converts the provided json to rich text and adds that as a note to the corresponding incident.

Go to Notes Tab to observe the corresponding Rich Text View of the JSON DATA.

"""




""" Don't Modify below lines of code """

def json_to_rich_text(data, initial_padding, padding=10):

    html = ""

    if isinstance(data, dict):
        for key, value in data.items():
            if isinstance(value, dict):
                html += "<strong style='padding-left:{0}px; color: #3366cc;'>{1}</strong>:<br><strong style='padding-left:{0}px; color: #1adf17;'>{{</strong><br>{2}<strong style='padding-left:{0}px; color: #1adf17;'>}}</strong>,<br>".format(
                        initial_padding, key,json_to_rich_text(value, initial_padding + padding, padding)
                        )
            elif isinstance(value, list):
                if len(value) == 0:
                    html += "<strong style='padding-left:{0}px; color: #993333;'>{1}</strong>: [ ]<span style='color: #1adf17;'>,</span> <br>".format(initial_padding, key)
                else:
                    html += "<strong style='padding-left:{0}px; color: #3366cc;'>{1}</strong>:<br><strong style='padding-left:{0}px; color: #1adf17;'>[</strong><br>{2}<strong style='padding-left:{0}px; color: #1adf17;'>]</strong>,<br>".format(
                            initial_padding, key, json_to_rich_text(value, initial_padding + padding, padding)
                            )
            else:
                html += "<strong style='padding-left:{0}px; color: #993333;'>{1}</strong>: {2}".format(
                        initial_padding, key,
                        json_to_rich_text(value, 5, padding)
                        )
    elif isinstance(data, list):
        for item in data:
            if isinstance(item, dict):
                html += "<br><strong style='padding-left:{0}px; color: #1adf17;'>{{</strong><br>{1}<strong style='padding-left:{0}px; color: #1adf17;'>}}</strong><br>".format(
                        initial_padding,
                        json_to_rich_text(item, initial_padding, padding)
                        )
            elif isinstance(item, list):
                html += "<br><strong style='padding-left:{0}px; color: #1adf17;'>[</strong><br>{1}<strong style='padding-left:{0}px; color: #1adf17;'>]</strong><br>".format(
                        initial_padding,
                        json_to_rich_text(item, initial_padding, padding)
                        )
            else:
                html += json_to_rich_text(item, initial_padding, padding)
    else:
        html += "<span style='padding-left:{0}px;'>{1}</span><span style='color: #1adf17;'>,</span><br>".format(initial_padding, data)
    return html


inputObject = playbook.properties.json_data

heading = inputObject.heading
jsonData = inputObject.content

htmlData = json_to_rich_text(jsonData, 20, 41)

header = f"<H1 style='margin: 20px 0; color:#FF3312; text-align: center;'>{heading}</H1>"

htmlData = header + htmlData

incident.addNote(helper.createRichText(htmlData))

```

---

