<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.1.0.695
-->

# Playbook - Threat Analysis with Uptycs Detections (PB)

### API Name
`threat_analysis_with_uptycs_detections_pb`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Object Type
`incident`

### Description
sample playbook to retrieve detection data and analyse on the data


---
## Function - uptycs api

### API Name
`uptycs_api`

### Output Name
`detectiondata`

### Message Destination
`fn_uptycs_api`

### Function-Input Script
```python
import json

# unique id of the detection
detectionID = incident.properties.uptycs_detection_id


# API endpoint
endpoint = f"/detections/{detectionID}"


inputs.uptycs_api_method = 'GET'
inputs.uptycs_api_endpoint = endpoint
inputs.uptycs_api_payload = json.dumps({})




```

---

## Global script - JSON TO HTML (RICH TEXT)

### Description
Converts provided JSON Data to Rich Text and adds it as a note to the corresponding Incident

### Script Type
`Global script`

### Object Type
`incident`

### Script Content
```python
"""
Set the Json Data that you would like to convert to rich text in a playbook property called "json_data" using playbook.addProperty('json_data', JSON_DATA)

JSON_DATA should have two keys, heading and content.

ex: JSON_DATA = {
   "heading" : "Uptycs Alert Data",
   "content" : {},   =======> json object
}

It converts the provided json to rich text and adds that as a note to the corresponding incident.

Go to Notes Tab to observe the corresponding Rich Text View of the JSON DATA.

"""




""" Don't Modify below lines of code """

def json_to_rich_text(data, initial_padding, padding=10):

    html = ""

    if isinstance(data, dict):
        for key, value in data.items():
            if isinstance(value, dict):
                html += "<strong style='padding-left:{0}px; color: #3366cc;'>{1}</strong>:<br><strong style='padding-left:{0}px; color: #1adf17;'>{{</strong><br>{2}<strong style='padding-left:{0}px; color: #1adf17;'>}}</strong>,<br>".format(
                        initial_padding, key,json_to_rich_text(value, initial_padding + padding, padding)
                        )
            elif isinstance(value, list):
                if len(value) == 0:
                    html += "<strong style='padding-left:{0}px; color: #993333;'>{1}</strong>: [ ]<span style='color: #1adf17;'>,</span> <br>".format(initial_padding, key)
                else:
                    html += "<strong style='padding-left:{0}px; color: #3366cc;'>{1}</strong>:<br><strong style='padding-left:{0}px; color: #1adf17;'>[</strong><br>{2}<strong style='padding-left:{0}px; color: #1adf17;'>]</strong>,<br>".format(
                            initial_padding, key, json_to_rich_text(value, initial_padding + padding, padding)
                            )
            else:
                html += "<strong style='padding-left:{0}px; color: #993333;'>{1}</strong>: {2}".format(
                        initial_padding, key,
                        json_to_rich_text(value, 5, padding)
                        )
    elif isinstance(data, list):
        for item in data:
            if isinstance(item, dict):
                html += "<br><strong style='padding-left:{0}px; color: #1adf17;'>{{</strong><br>{1}<strong style='padding-left:{0}px; color: #1adf17;'>}}</strong><br>".format(
                        initial_padding,
                        json_to_rich_text(item, initial_padding, padding)
                        )
            elif isinstance(item, list):
                html += "<br><strong style='padding-left:{0}px; color: #1adf17;'>[</strong><br>{1}<strong style='padding-left:{0}px; color: #1adf17;'>]</strong><br>".format(
                        initial_padding,
                        json_to_rich_text(item, initial_padding, padding)
                        )
            else:
                html += json_to_rich_text(item, initial_padding, padding)
    else:
        html += "<span style='padding-left:{0}px;'>{1}</span><span style='color: #1adf17;'>,</span><br>".format(initial_padding, data)
    return html


inputObject = playbook.properties.json_data

heading = inputObject.heading
jsonData = inputObject.content

htmlData = json_to_rich_text(jsonData, 20, 41)

header = f"<H1 style='margin: 20px 0; color:#FF3312; text-align: center;'>{heading}</H1>"

htmlData = header + htmlData

incident.addNote(helper.createRichText(htmlData))

```

---
## Local script - Set JSON Data(for converting to HTML)

### Description
Sets Json Data to get its corresponding Rich Text

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
"""
Set Detection data to playbook property named "json_data" to get the corresponding Rich Text HTML Code
"""

jsonData = {
   "heading": "Uptycs Detection Data",
   "content": playbook.functions.results.detectiondata.content
}


playbook.addProperty('json_data', jsonData)


```

---

